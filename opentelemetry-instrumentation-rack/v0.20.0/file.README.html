<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>
  File: README
  
    &mdash; OpenTelemetry
  
</title>

  <link rel="stylesheet" href="css/style.css" type="text/css" />

  <link rel="stylesheet" href="css/common.css" type="text/css" />

<script type="text/javascript">
  pathId = "README";
  relpath = '';
</script>


  <script type="text/javascript" charset="utf-8" src="js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="js/app.js"></script>


  </head>
  <body>
    <div class="nav_wrap">
      <iframe id="nav" src="file_list.html?1"></iframe>
      <div id="resizer"></div>
    </div>

    <div id="main" tabindex="-1">
      <div id="header">
        <div id="menu">
  
    <a href="_index.html">Index</a> &raquo; 
    <span class="title">File: README</span>
  
</div>

        <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="class_list.html">

        <svg width="24" height="24">
          <rect x="0" y="4" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="12" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="20" width="24" height="4" rx="1" ry="1"></rect>
        </svg>
    </a>
  
</div>
        <div class="clear"></div>
      </div>

      <div id="content"><div id='filecontents'>
<h1 id="label-OpenTelemetry+Rack+Instrumentation">OpenTelemetry Rack Instrumentation</h1>

<p>The Rack instrumentation is a community-maintained instrumentation for the <a href="https://github.com/rack/rack">Rack</a> web server interface.</p>

<h2 id="label-How+do+I+get+started-3F">How do I get started?</h2>

<p>Install the gem using:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_gem'>gem</span> <span class='id identifier rubyid_install'>install</span> <span class='id identifier rubyid_opentelemetry'>opentelemetry</span><span class='op'>-</span><span class='id identifier rubyid_instrumentation'>instrumentation</span><span class='op'>-</span><span class='id identifier rubyid_rack'>rack</span>
</code></pre>

<p>Or, if you use <a href="https://bundler.io">bundler</a>, include <code>opentelemetry-instrumentation-rack</code> in your <code>Gemfile</code>.</p>

<h2 id="label-Usage">Usage</h2>

<p>To use the instrumentation, call <code>use</code> with the name of the instrumentation:</p>

<pre class="code ruby"><code class="ruby"><span class='const'><span class='object_link'><a href="OpenTelemetry.html" title="OpenTelemetry (module)">OpenTelemetry</a></span></span><span class='op'>::</span><span class='const'>SDK</span><span class='period'>.</span><span class='id identifier rubyid_configure'>configure</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_c'>c</span><span class='op'>|</span>
  <span class='id identifier rubyid_c'>c</span><span class='period'>.</span><span class='id identifier rubyid_use'>use</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>OpenTelemetry::Instrumentation::Rack</span><span class='tstring_end'>&#39;</span></span>
<span class='kw'>end</span>
</code></pre>

<p>Alternatively, you can also call <code>use_all</code> to install all the available instrumentation.</p>

<pre class="code ruby"><code class="ruby"><span class='const'><span class='object_link'><a href="OpenTelemetry.html" title="OpenTelemetry (module)">OpenTelemetry</a></span></span><span class='op'>::</span><span class='const'>SDK</span><span class='period'>.</span><span class='id identifier rubyid_configure'>configure</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_c'>c</span><span class='op'>|</span>
  <span class='id identifier rubyid_c'>c</span><span class='period'>.</span><span class='id identifier rubyid_use_all'>use_all</span>
<span class='kw'>end</span>
</code></pre>

<h2 id="label-Controlling+span+name+cardinality">Controlling span name cardinality</h2>

<p>By default we will set the rack span name to match the format “HTTP #method” (ie. HTTP GET). There are different ways to control span names with this instrumentation.</p>

<h3 id="label-Enriching+rack+spans">Enriching rack spans</h3>

<p>We surface a hook to easily retrieve the rack span within the context of a request so that you can add information to or rename your server span.</p>

<p>This is how the rails controller instrumentation is able to rename the span names to match the controller and action that process the request. See <a href="https://github.com/open-telemetry/opentelemetry-ruby/blob/f6fb025bef69f839078748f56516ce38c7d51eb8/instrumentation/action_pack/lib/opentelemetry/instrumentation/action_pack/patches/action_controller/metal.rb#L15-L16">github.com/open-telemetry/opentelemetry-ruby/blob/f6fb025bef69f839078748f56516ce38c7d51eb8/instrumentation/action_pack/lib/opentelemetry/instrumentation/action_pack/patches/action_controller/metal.rb#L15-L16</a> for an example.</p>

<h3 id="label-High+cardinality+example">High cardinality example</h3>

<p>You can pass in an url quantization lambda that simply uses the URL path, the result is you will end up with high cardinality span names, however this may be acceptable in your deployment and is easy configurable using the following example.</p>

<pre class="code ruby"><code class="ruby"><span class='const'><span class='object_link'><a href="OpenTelemetry.html" title="OpenTelemetry (module)">OpenTelemetry</a></span></span><span class='op'>::</span><span class='const'>SDK</span><span class='period'>.</span><span class='id identifier rubyid_configure'>configure</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_c'>c</span><span class='op'>|</span>
  <span class='id identifier rubyid_c'>c</span><span class='period'>.</span><span class='id identifier rubyid_use'>use</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>OpenTelemetry::Instrumentation::Rack</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='lbrace'>{</span> <span class='label'>url_quantization:</span> <span class='tlambda'>-&gt;</span><span class='lparen'>(</span><span class='id identifier rubyid_path'>path</span><span class='comma'>,</span> <span class='id identifier rubyid__env'>_env</span><span class='rparen'>)</span> <span class='tlambeg'>{</span> <span class='id identifier rubyid_path'>path</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span> <span class='rbrace'>}</span> <span class='rbrace'>}</span>
<span class='kw'>end</span>
</code></pre>

<h2 id="label-Examples">Examples</h2>

<p>Example usage can be seen in the <code>./example/trace_demonstration.rb</code> file <a href="https://github.com/open-telemetry/opentelemetry-ruby/blob/main/instrumentation/rack/example/trace_demonstration.rb">here</a></p>

<h2 id="label-How+can+I+get+involved-3F">How can I get involved?</h2>

<p>The <code>opentelemetry-instrumentation-rack</code> gem source is <a href="https://github.com/open-telemetry/opentelemetry-ruby">on github</a>, along with related gems including <code>opentelemetry-api</code> and <code>opentelemetry-sdk</code>.</p>

<p>The OpenTelemetry Ruby gems are maintained by the OpenTelemetry-Ruby special interest group (SIG). You can get involved by joining us in <a href="https://github.com/open-telemetry/opentelemetry-ruby/discussions">GitHub Discussions</a> or attending our weekly meeting. See the <a href="https://github.com/open-telemetry/community#community-meetings">meeting calendar</a> for dates and times. For more information on this and other language SIGs, see the OpenTelemetry <a href="https://github.com/open-telemetry/community#ruby-sig">community page</a>.</p>

<h2 id="label-License">License</h2>

<p>The <code>opentelemetry-instrumentation-rack</code> gem is distributed under the Apache 2.0 license. See <a href="https://github.com/open-telemetry/opentelemetry-ruby/blob/main/LICENSE">LICENSE</a> for more information.</p>
</div></div>

      <div id="footer">
  Generated on Thu Oct  7 03:39:40 2021 by
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.9.26 (ruby-2.7.4).
</div>

    </div>
  </body>
</html>